[<назад>](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET)
# Лабораторная работа №2 (Вариант 1)
## Цель работы
Закрепить практические навыки, полученные при изучении дисциплины «Основы программирования».  Решение задач с использованием динамических структур, работа с файлами.
## Техническое задание
### Общие требования 
1. Во всех вариантах нужно создать базу данных, согласно варианту задания
2. В каждой базе должна быть статическая переменная для учета общего числа элементов в базе данных.
3. Данные размещаются в динамической памяти.
4. Обязательные функции для всех вариантов:
    + добавить новый элемент в базу
    + распечатка данных в табличном виде
    + выход из программы
5. Остальные функции для работы с базой указаны в задании индивидуально.
6. Для выполнения функций, указанных в задании, написать диалоговый интерфейс, позволяющий выполнять функции в произвольном порядке многократно
7. При выполнении функции «выход из программы» нужно сохранить базу на диске
8. Первичное создание базы – ввод данных с клавиатуры
9. Если программа уже запускалась, то данные загружаются из файла перед выходом на диалог. Иными словами вносятся изменения и дополнения в уже существующую базу данных.
10.  При реализации функций в параметрах и возвращаемых значениях использовать указатели и ссылки
11. Выполнить задание лабораторной работы №1 в стиле ООП. Для этого видоизменить программу, разработанную ранее.
12. Дополнить проект в соответствии с вашим вариантом задания.
13. В заданиях используются следующие сокращения:
  pub– открытые данные (public),  
  pri – закрытые данные (private),  
  СД – статические данные (в единственном экземпляре, общие для всего класса),  
  НСД – нестатические данные тиражируются для каждого объекта,  
  КК – конструктор копирования,  
  ДФ – дружественная функция,  
  МК- метод класса.  
  Например поле, помеченное СД, pri означает статическую переменную, размещенную в закрытой области.  
14. Если поле никак не отмечено, то считать его открытым
15. Для текстовых данных в классе создавать указатели на строки, а в конструкторах динамически выделять память под строки, в деструкторах – возвращать в кучу.
16. В задании указаны методы, которые создаются обязательно, но вы не должны этим ограничиваться. Как правило, для работы требуются и другие методы, какие – решать вам.
17. Оценка лабораторной работы проходит по 2 критериям:  
    • оценка проекта (элементы класса: данные, методы и т.п.)	- 50%  
    • оценка реализации (сама программа) – 50%  
### Требования по варианту
+ База данных: Пищевое производство (расчеты).
+ Создать класс food (видоизменить программу) со следующими элементами:
  + данные-члены класса:
    ```c++
    char* fam ; (pri)	  //Название изделия
    int   type;   (pri)         //тип изделия (1- булочка, 2-пирожок, 3-пирожное)
    double weight; (pri)   // вес
    int quant;		// количество
    double cost;		//стоимость
    static int count;        // счетчик существующих объектов класса
    ```
  + функции-члены класса:
    1. Создать обязательные функции, указанные в общих требованиях (МК).
    2. Создать функции для данного варианта: 
      + Поиск изделий по названию (МК),
      + Фильтр по типу (найти изделия заданного типа) (ДФ),
      + Сортировать по уменьшению стоимости (сначала более дорогие) (ДФ).
+ Тестовая программа №1:  
    • Базу данных (массив объектов) располагать в динамической памяти.  
    • При запуске программы данные ввести с клавиатуры (первый запуск программы) или загрузить с диска (все последующие запуски).  
    • Добавить несколько новых элементов (ввод с клавиатуры).  
    • Выполнить все реализованные функции (поиск, фильтр, сортировка).  
    • При выходе из программы запомнить измененную базу на диске.  

### Пример диалогового интерфейса (База данных «Склад товаров»)
![image](https://user-images.githubusercontent.com/57076699/221278362-82021063-f4c1-428b-9342-7202cbf5acd8.png)

### Пример распечатки данных в табличном виде (База данных «Склад товаров»)
![image](https://user-images.githubusercontent.com/57076699/221285525-babe4c51-90ee-4f44-bf6c-b5434ff33de8.png)

## Реализация технического задания

### Сторонние возможности
При реализации программы были использованы следующие возможности из библиотек:
```c++
#include <fstream> // работа с файлами
#include <iostream> // работа с потоками ввода-вывода
#include <iomanip>  // и его модификация 
#include <string>                     // работа со строками
#include <boost/algorithm/string.hpp> // работа со строками
#include <cmath> // сравнение вещественных чисел
```
### Архитектура приложения

Приложение состоит из следующих сущностей:  
  - ```class Food{...}``` - элемет базы хранит в себе данные о записи,  
  - ```class Base{...}``` - база данных,  
  - ```class BaseInterface{...}``` - интерфейс форматированного вывода базы данных,  
  - ```class Interactor{...}``` - интерфейс для взаимодействия с пользователем,также слежит для валидации данных  

Кроме того используются следующие перечисления:
```c++
enum typeOfProduct { // тип продукта
    BUN = 1, PIE, CAKE
};
```
```c++
enum error { // обработка ошибок
    NO_ERROR,
    OUT_OF_MEMORY,
    PRODUCT_ALREADY_IN_BASE,
    CANT_SAVE_CHANGES,
    PRODUCT_NOT_IN_BASE
};
```
```c++
enum compareDirection { // определение направления для фильтрации ввода
    MORE_THEN, LESS_THEN, EQUAL_TO
};
```
```c++
enum sortingDirection { // определение для направления сортировки
    ASCENDING, DESCENDING
};
```
  
#### Сигнатуры классов

##### Food
```c++
class Food {
public:

//конструкторы
    Food();
    Food(const Food &item);
    explicit Food(std::string s);
    Food(std::string fam, typeOfProduct type, double weight, int quant, double price);

//преобразование записи в базе в строку
    [[nodiscard]] std::string* parseToString() const;
    
//сравненение записи по полю
    // if (this->field > fieldValue) then return > 0
    int moreThen(itemField f, Food& item);
    int moreThen(itemField f, double fieldValue);
    int moreThen(itemField f, int fieldValue);
    int moreThen(itemField f, std::string fieldValue);
    int moreThen(itemField f, typeOfProduct fieldValue);

//меняется значения записей местами
    static void swap(Food &a, Food&b);

//геттеры
    static int getObjNum();
    void getFam(std::string &dest) const;
    typeOfProduct getType() const;
    double getWeight() const;
    int getQuant() const;
    double getPrice() const;
 
 //сеттеры
    void setFam(std::string fieldVal);
    void setType(typeOfProduct fieldVal);
    void setQuant(int fieldVal);
    void setPrice(double fieldVal);
    void setWeight(double fieldVal);

//деконструктор
    ~Food();

private:
    std::string fam; // название продукта
    typeOfProduct type; // тип продукта
    double weight; //вес продукта
    int quant; //количество единиц продукта
    double price; //цена продукта
    static int objNum; //количество объектов в программе(динамически меняется во время работы программы)
};
```
##### Base
```c++
class Base {
public:

// конструторы
    Base() = default;
    explicit Base(const std::string& file); // по совместительству импорт базы из файла

// добавление продукта в базу (возвращает !NO_ERROR если добавить не удалось
    error addItem(const Food &item);
     
// удаление продукта из базу (возвращает !NO_ERROR если добавить не удалось
    error removeItem(const std::string &name);
    
// сортирует элементы в базе
    void sort(sortingDirection sortDirection, itemField sortingField);

// экспортирует базу в файл
    error saveTofFile();
    
// проверяет последний экспорт базы в файл
    bool isSaved() const;

// BaseInterface объявлен другом этого класса
    friend class BaseInterface;
    
// деструктор
    ~Base();

private:
    bool saveState{}; // есть ли различия между базой в файле и в динамической памяти
    std::string filename; // название файла из которого открывалась база
    Food* itemsArr{}; // массив элементов базы
    unsigned int length{}; // длина массива
    
    int getItem(const std::string &name); // взять
};
```

##### BaseInterface
```c++
class BaseInterface {
public:

// форматированный нефильтрованный вывод
    static void print(Base &base); 

// фильтрованный вывод базы
    template<typename T>
    static void printBaseByFilter(Base &base, itemField field, T fieldValue, compareDirection cd); 

private:

// печать заголовка таблицы
    static void printTablesTop(); 

// печать ячейки таблицы
    static void printItem(Food &item); 

// печать итогов таблицы
    static void printTablesBot(double totalPrice, unsigned int totalPos);
};
```

##### Interactor
```c++
class Interactor {
public:
// обработка выхода из программы
    static bool exitProgram(Base &base);

// сохранение изменений
    static bool saveChanges(Base &base);

// уведомляет пользователя о неправильном вводе
    static bool wrongInputWarning();

// получение данных продуктов от пользователя
    static bool getItem(Food &dest);

// получение типа поля от пользователя
    static bool getItemField(itemField &dest);

// получение направления фильтрации от пользователя
    static bool getFilterDirection(compareDirection &dest);

// получение направления сортировки от пользователя
    static bool getSortingDirection(sortingDirection &dest);

// получение опции взаимодействия с базой от пользователя
    static int getOption();

// получение значения поля от пользователя
    template<typename T>
    static bool getItemFieldValue(itemField field, T *fieldValue);
    static bool getItemFieldValue(itemField field, std::string *fieldValue);
    static bool getItemFieldValue(itemField field, typeOfProduct *fieldValue);

private:

// печать инструкции в зависимости от ввода пользователя
    static void printInstruction(itemField field);
};

```
#### Реализация методов

| BaseInterface | Base | Interactor | Food |
|:---:|:---:|:---:|:---:|
| [BaseInterface.cpp](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/BaseInterface.cpp) | [Base.cpp](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/Base.cpp) | [Interactor.cpp](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/Interactor.cpp) | [Food.cpp](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/Food.cpp) |
| [BaseInterface.h](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/BaseInterface.h) | [Base.h](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/Base.h) | [Interactor.h](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/Interactor.h) | [Food.h](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/Food.h) |

#### Схематическое описание взаимодействия элементов программы и пользователя

![image](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET/blob/main/Lab_02/Project.drawio.svg)

#### Пример работы программы

##### Начало работы (меню программы)
```
--------------------------------------------------------------------------------------------------------------------------------------
Print............................1
Add new product..................2
Delete product by name...........3
Print filtered by field..........4
Sort.............................5
Save changes.....................6
Exit program.....................7

Enter option: 
```
> На любой невалидный ввод программа регирует следующим образом: ``` Wrong input!```.
> Кроме того программа прекращает взаимодействовать с пользователем в районе данной опции программы и выводит меню.
> Например:
```
Enter option: 2
Enter product name (all symbols except ';') and press Enter: Name 
Enter product type(1 - bun, 2 - pie, 3 - cake) and press Enter: 1 asd qwe
Wrong input!

...
\\\ Menu
...
```

##### Вывод занесенной базы на экран 
```
...
Enter option: 1

Name of product                         Type      Weight              Quantity            Price(rub)          Total Price         
--------------------------------------------------------------------------------------------------------------------------------------
cake12                                  CAKE      0.2                 5                   500                 2500                
pie3                                    PIE       3.14                15                  199                 2985                
cake2                                   CAKE      0.8                 13                  175                 2275                
cake3                                   CAKE      5.9                 4                   145                 580                 
bun3                                    BUN       2.78                47                  123                 5781                
bun10                                   BUN       0.4                 21                  65                  1365                
bun2                                    BUN       0.6                 92                  25                  2300                
pie2                                    PIE       1.3                 41                  20                  820                 
pie35                                   PIE       0.3                 14                  15                  210                 
2                                       CAKE      5                   6                   4                   24                  
qwe                                     BUN       1                   1                   1                   1                   
--------------------------------------------------------------------------------------------------------------------------------------
Total PRICE of all products: .................................................................................18841
Total positions: .............................................................................................11
Object number: ...............................................................................................11
...
```

>В академических целях добавлен вывод на экран количества созданных объектов класса Food: ```Object number: ......11```, который в свою очередь меняется в зависимости от количесвтва объектов в базе. Форматированный вывод меняет количество итогов таблицы, за исключением последнего(количество объектов меняется только функциями (2) и (3) вышеописанного меню) 

##### Добавление продукта
```
...
Enter option: 2
Enter product name (all symbols except ';') and press Enter: My Cake 
Enter product type(1 - bun, 2 - pie, 3 - cake) and press Enter: 3
Enter product quantity and press Enter: 25
Enter product weight and press Enter: 0.3
Enter product price and press Enter: 140
Item added.

... 
\\\ Menu
....

Enter option: 1

Name of product                         Type      Weight              Quantity            Price(rub)          Total Price         
--------------------------------------------------------------------------------------------------------------------------------------
cake12                                  CAKE      0.2                 5                   500                 2500                
pie3                                    PIE       3.14                15                  199                 2985                
cake2                                   CAKE      0.8                 13                  175                 2275                
cake3                                   CAKE      5.9                 4                   145                 580                 
bun3                                    BUN       2.78                47                  123                 5781                
bun10                                   BUN       0.4                 21                  65                  1365                
bun2                                    BUN       0.6                 92                  25                  2300                
pie2                                    PIE       1.3                 41                  20                  820                 
pie35                                   PIE       0.3                 14                  15                  210                 
2                                       CAKE      5                   6                   4                   24                  
qwe                                     BUN       1                   1                   1                   1                   
My Cake                                 CAKE      0.3                 25                  140                 3500                
--------------------------------------------------------------------------------------------------------------------------------------
Total PRICE of all products: .................................................................................22341
Total positions: .............................................................................................12
Object number: ...............................................................................................12
...

```

##### Удаление продукта по названию
```
...
Enter option: 3
Enter product name (all symbols except ';') and press Enter: cake12
Item removed.

... 
\\\ Menu
....

Enter option: 1

Name of product                         Type      Weight              Quantity            Price(rub)          Total Price         
--------------------------------------------------------------------------------------------------------------------------------------
pie3                                    PIE       3.14                15                  199                 2985                
cake2                                   CAKE      0.8                 13                  175                 2275                
cake3                                   CAKE      5.9                 4                   145                 580                 
bun3                                    BUN       2.78                47                  123                 5781                
bun10                                   BUN       0.4                 21                  65                  1365                
bun2                                    BUN       0.6                 92                  25                  2300                
pie2                                    PIE       1.3                 41                  20                  820                 
pie35                                   PIE       0.3                 14                  15                  210                 
2                                       CAKE      5                   6                   4                   24                  
qwe                                     BUN       1                   1                   1                   1                   
My Cake                                 CAKE      0.3                 25                  140                 3500                
--------------------------------------------------------------------------------------------------------------------------------------
Total PRICE of all products: .................................................................................19841
Total positions: .............................................................................................11
Object number: ...............................................................................................11
...
```

##### Вывод занесенной базы с фильтром
```
...
Enter option: 4

Choose product characteristic:
1 - Name
2 - Type
3 - Price
4 - Quantity
5 - Weight
and press Enter: 4

Choose sort direction:
1 - Less then entered value
2 - More then entered value
3 - Equal to entered value
and press Enter: 2
Enter product quantity and press Enter: 30

Name of product                         Type      Weight              Quantity            Price(rub)          Total Price         
--------------------------------------------------------------------------------------------------------------------------------------
bun3                                    BUN       2.78                47                  123                 5781                
bun2                                    BUN       0.6                 92                  25                  2300                
pie2                                    PIE       1.3                 41                  20                  820                 
--------------------------------------------------------------------------------------------------------------------------------------
Total PRICE of all products: .................................................................................8901
Total positions: .............................................................................................3
Object number: ...............................................................................................11
...
```

##### Сортировка
```
...
Enter option: 5

Choose product characteristic:
1 - Name
2 - Type
3 - Price
4 - Quantity
5 - Weight
and press Enter: 3

Choose sort direction:
1 - Ascending
2 - Descending
and press Enter: 2
Base sorted!

... 
\\\ Menu
....

Enter option: 1

Name of product                         Type      Weight              Quantity            Price(rub)          Total Price         
--------------------------------------------------------------------------------------------------------------------------------------
pie3                                    PIE       3.14                15                  199                 2985                
cake2                                   CAKE      0.8                 13                  175                 2275                
cake3                                   CAKE      5.9                 4                   145                 580                 
My Cake                                 CAKE      0.3                 25                  140                 3500                
bun3                                    BUN       2.78                47                  123                 5781                
bun10                                   BUN       0.4                 21                  65                  1365                
bun2                                    BUN       0.6                 92                  25                  2300                
pie2                                    PIE       1.3                 41                  20                  820                 
pie35                                   PIE       0.3                 14                  15                  210                 
2                                       CAKE      5                   6                   4                   24                  
qwe                                     BUN       1                   1                   1                   1                   
--------------------------------------------------------------------------------------------------------------------------------------
Total PRICE of all products: .................................................................................19841
Total positions: .............................................................................................11
Object number: ...............................................................................................11
...
```

##### Импорт данных из базы в файл
```
...
Enter option: 6
Press enter to SAVE, enter any other character to CANCEL changes:d
Saving cancelled.

... 
\\\ Menu
....

Enter option: 6
Press enter to SAVE, enter any other character to CANCEL changes:
Changes are successfully saved!
...
```

##### Завершение работы
```
Enter option: 7
Would you like to save changes?
Press enter to SAVE, enter any other character to CANCEL changes:d
Saving cancelled.
Press enter to EXIT, enter any other character to continue work with program:d

... 
\\\ Menu
....

Enter option: 7
Would you like to save changes?
Press enter to SAVE, enter any other character to CANCEL changes:
Changes are successfully saved!
Press enter to EXIT, enter any other character to continue work with program:
See ya!

...
```

## Ответы на контрольные вопросы

### 1. Что представляет собой класс?
Класс - это набор данных-членов и данных-функций, сгруппированных под одним именем. С точки зрения языка можно описывать класс как пользовательский тип данных, а объекты(экземпляры) класса как его значение.
### 2. Какие элементы класса Вы знаете?
Данные-члены(data members) класса - это структурный тип данных описывающее набор полей(свойств) и их начальное состояние.
Функции-члены класса(function members) или методы - алгоритмы для изменение состояния свойств класса и/или свойств экземпляра класса.
### 3. Перечислите спецификаторы доступа, используемые в классе, для чего нужен каждый из них.  
Спецификатор доступа - возможность языка ограничить область видимости ДЧ и ДФ класса. Механизм реализации инкапсуляции.  

Private - закрытые или собственные  
  + Функции-члены класса, который изначально объявил эти элементы.  
    
Public - открытые или общедоступные 
  + Без ограничений  
    
Protected - защищенные.  
  + Функции-члены класса, который изначально объявил эти элементы.  
  + Дружественные элементы класса, который изначально объявил эти элементы.  
  + Классы, производные с использованием открытого или защищенного доступа от класса, который изначально объявил эти элементы.  
  + Прямые производные с использованием закрытого доступа классы, которые также имеют закрытый доступ к защищенным элементам.  
     
### 4. Как осуществляется доступ к элементам класса?
Доступ к элементам или полям класса можно осуществить тремя способами:
-  имя_представителя_класса.имя_элемента;
-  имя_класса::имя_элемента;
-  указатель_на_представителя_класса->имя_элемента.

### 5. Для каких целей используется конструктор? Приведите пример.
Конструктор функция-член класса, который нужен для задания способа(-ов) инициализации членов класса или вызвать функции при создании объекта класса.
Примеры конструкторов:
```
//конструкторы
    Food();    // Конструктор по умолчанию
    Food(const Food &item); // Конструктор копирования
    explicit Food(std::string s); // Конструктор с параметрами
    Food(std::string fam, typeOfProduct type, double weight, int quant, double price); // Конструктор с параметрами
```
### 6. Для каких целей используется  деструктор? Приведите пример.
Деструктор — это функция-член, которая вызывается автоматически, когда объект выходит за пределы области или явно уничтожается вызовом ```delete```.
Пример деструктора:
```
~Base();
```
### 7. Что такое область видимости, применительно к данным-членам класса?
Область видимости - свойство быть доступным как из класса-родителя, так и из других классов, т. е. из различных областей программы.
### 8. Как можно изменить область видимости с помощью ключевых слов?
Ограничить полностью или частично доступ к элементам класса.
### 9. Что такое друзья класса?
Механизм под названием «друзья класса» действует более гибко и позволяет предоставлять доступ избирательно. Например, можно предоставить доступ к закрытым переменным класса для отдельной функции или же для целого класса.
Друзья класса–это функции и классы, у которых есть полный доступ к классу, такой же, как у его собственных функций. Для получения прав друга, функция должна быть описана в классе со спецификацией friend.
### 10. Сравните характер доступа, предоставленный с помощью ключа public, с доступом, предоставленным с помощью дружественных функций.
Public - не имеет доступа к закрытым и защещенным полям класса  
friend - имеет доступ к закрытым и защищенным полям класса
### 11. Статические поля класса, для чего они нужны, чем отличаются от прочих полей класса?
Статическое поле данных класса принадлежит всем объектам данного класса и существует в единственном экземпляре. При создании объектов класса статические поля не тиражируются, в отличие от остальных данных-членов класса. Следует отметить, что доступ к статическому полю возможен только после инициализации (выделения памяти и задания начального значения). Инициализировать статическую переменную нужно вне класса в глобальной области данных для того, чтобы экземпляры класса, создаваемые после этого имели к ней доступ. 


[<назад>](https://github.com/xXxINFARKTxXx/OOP2023SpringMIET)
